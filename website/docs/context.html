<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Context Management ‚Äî Context Pilot</title>
    <meta name="description" content="How Context Pilot manages what the AI sees ‚Äî panels, context elements, tokens, and the context budget.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="docs.css">
</head>
<body>

<nav class="nav">
    <div class="nav-inner">
        <a href="../" class="nav-logo">
            <span class="nav-logo-icon">‚öô</span>
            <span>Context Pilot</span>
        </a>
        <div class="nav-links">
            <a href="./">Docs</a>
            <a href="getting-started.html">Get Started</a>
            <a href="tools.html">Tools</a>
            <a href="modules.html">Modules</a>
            <a href="https://github.com/bigmoostache/context-pilot" target="_blank">GitHub</a>
        </div>
    </div>
</nav>

<div class="docs-layout">
    <aside class="docs-sidebar">
        <h3>On this page</h3>
        <a href="#overview">Overview</a>
        <a href="#elements">Context Elements</a>
        <a href="#panels">Panels</a>
        <a href="#budget">Token Budget</a>
        <a href="#management">Context Management</a>
        <a href="#lifecycle">Element Lifecycle</a>

        <h3>Reference</h3>
        <a href="tools.html">All 58 Tools</a>
        <a href="modules.html">Modules</a>
        <a href="agents.html">Agents & Skills</a>
    </aside>

    <main class="docs-content">
        <h1>Context Management</h1>
        <p class="subtitle">
            How Context Pilot manages what the AI sees ‚Äî the core concept that
            makes everything else work.
        </p>

        <h2 id="overview">Overview</h2>
        <p>
            Every message sent to the LLM includes a set of <strong>context elements</strong> ‚Äî
            the system prompt, tool definitions, file contents, memories, logs, conversation history,
            and more. Context Pilot makes these elements visible, measurable, and manageable.
        </p>

        <div class="callout callout-info">
            <strong>‚ÑπÔ∏è Key insight</strong>
            In most AI tools, context is invisible ‚Äî you can't see what the AI knows. In Context Pilot,
            every context element is a visible panel with a measured token count.
        </div>

        <h2 id="elements">Context Elements</h2>
        <p>Context elements are ordered by priority. The LLM sees them in this order:</p>

        <table>
            <thead><tr><th>Type</th><th>Description</th><th>Example</th></tr></thead>
            <tbody>
                <tr><td><strong>System prompt</strong></td><td>Active agent's instructions</td><td>~100 tokens</td></tr>
                <tr><td><strong>Tool definitions</strong></td><td>All enabled tool schemas</td><td>~10K tokens</td></tr>
                <tr><td><strong>Core panels</strong></td><td>Memories, callbacks, library, scratchpad</td><td>~3K tokens</td></tr>
                <tr><td><strong>File panels</strong></td><td>Opened source files</td><td>Variable</td></tr>
                <tr><td><strong>Dynamic panels</strong></td><td>Git, search results, console output</td><td>Variable</td></tr>
                <tr><td><strong>History panels</strong></td><td>Previous conversation segments</td><td>Variable</td></tr>
                <tr><td><strong>Tree</strong></td><td>Directory structure with descriptions</td><td>~2K tokens</td></tr>
                <tr><td><strong>Todos</strong></td><td>Active task list</td><td>Variable</td></tr>
                <tr><td><strong>Logs</strong></td><td>Timestamped event log</td><td>Variable</td></tr>
                <tr><td><strong>Conversation</strong></td><td>Current chat messages</td><td>Growing</td></tr>
            </tbody>
        </table>

        <h2 id="panels">Panels</h2>
        <p>
            Panels are the visual representation of context elements in the sidebar.
            Each panel has:
        </p>
        <ul>
            <li><strong>ID</strong> ‚Äî e.g., P5, P11, P23</li>
            <li><strong>Type</strong> ‚Äî file, console, git, search, etc.</li>
            <li><strong>Token count</strong> ‚Äî how much context space it uses</li>
            <li><strong>Content</strong> ‚Äî visible in the main panel area</li>
        </ul>

        <h3>Core panels (P1-P7)</h3>
        <p>These cannot be closed and are always present:</p>
        <ul>
            <li><strong>P1</strong> ‚Äî Todo list</li>
            <li><strong>P2</strong> ‚Äî Library (agents, skills, commands)</li>
            <li><strong>P3</strong> ‚Äî Statistics (context usage, git changes)</li>
            <li><strong>P4</strong> ‚Äî Tools (all 58 tools with status)</li>
            <li><strong>P5</strong> ‚Äî Directory tree</li>
            <li><strong>P6</strong> ‚Äî Memories</li>
            <li><strong>P7</strong> ‚Äî Spine (notifications, auto-continuation)</li>
        </ul>

        <h3>Dynamic panels (P8+)</h3>
        <p>Created by tool calls ‚Äî file opens, git commands, search results, console output. The AI can close these with <code>Close_panel</code> to free context space.</p>

        <h2 id="budget">Token Budget</h2>
        <p>
            Context Pilot tracks token usage across all elements. The Statistics panel (P3)
            shows current usage vs. the budget:
        </p>
        <ul>
            <li><strong>Budget</strong> ‚Äî maximum tokens the model supports (~200K for Claude Sonnet)</li>
            <li><strong>Threshold</strong> ‚Äî soft limit where context should be managed (~140K)</li>
            <li><strong>Current usage</strong> ‚Äî sum of all context element tokens</li>
        </ul>

        <div class="callout callout-warning">
            <strong>‚ö†Ô∏è Context overflow</strong>
            When context approaches the budget, the AI should close stale panels, summarize histories,
            and remove unnecessary elements. If it doesn't, you can ask it to clean up.
        </div>

        <h2 id="management">Context Management Strategies</h2>
        <h3>The AI manages its own context</h3>
        <p>Context Pilot's AI is instructed to manage context proactively:</p>
        <ul>
            <li>Close files after editing (they served their purpose)</li>
            <li>Close old conversation histories (preserving info as logs/memories first)</li>
            <li>Close search result panels after extracting relevant information</li>
            <li>Close console panels after checking output</li>
        </ul>

        <h3>You can help</h3>
        <ul>
            <li>Ask the AI to "clean your context" when things feel cluttered</li>
            <li>Use the sidebar to see which panels are consuming the most tokens</li>
            <li>The Statistics panel (P3) shows accumulated costs per element</li>
        </ul>

        <h2 id="lifecycle">Element Lifecycle</h2>
        <ol>
            <li><strong>Created</strong> ‚Äî a tool call opens a file, runs a command, creates a panel</li>
            <li><strong>Active</strong> ‚Äî the element is visible to the AI and counted in the token budget</li>
            <li><strong>Auto-refreshed</strong> ‚Äî some panels (git, github) refresh periodically</li>
            <li><strong>Closed</strong> ‚Äî removed from context via <code>Close_panel</code> or auto-suicide</li>
        </ol>

        <h3>Auto-suicide</h3>
        <p>Some panels clean themselves up automatically:</p>
        <ul>
            <li><strong>File panels</strong> ‚Äî suicide when the file is deleted from disk</li>
            <li><strong>Console panels</strong> ‚Äî suicide when the session is lost or a newer callback panel replaces it</li>
            <li><strong>Watchers</strong> ‚Äî suicide when their target console session vanishes</li>
        </ul>
    </main>
</div>

<footer class="footer">
    <div class="footer-inner">
        <p>Built with ü¶Ä Rust and ‚ù§Ô∏è by the Context Pilot contributors. <a href="https://github.com/bigmoostache/context-pilot" target="_blank">GitHub</a></p>
    </div>
</footer>

</body>
</html>
