<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Usage ‚Äî Context Pilot</title>
    <meta name="description" content="Autonomous workflows, callbacks, presets, web search, PDF generation, and power-user tips.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="docs.css">
</head>
<body>

<nav class="nav">
    <div class="nav-inner">
        <a href="../" class="nav-logo">
            <span class="nav-logo-icon">‚öô</span>
            <span>Context Pilot</span>
        </a>
        <div class="nav-links">
            <a href="./">Docs</a>
            <a href="getting-started.html">Get Started</a>
            <a href="tools.html">Tools</a>
            <a href="modules.html">Modules</a>
            <a href="https://github.com/bigmoostache/context-pilot" target="_blank">GitHub</a>
        </div>
    </div>
</nav>

<div class="docs-layout">
    <aside class="docs-sidebar">
        <h3>On this page</h3>
        <a href="#autonomous">Autonomous Workflows</a>
        <a href="#callbacks">File Edit Callbacks</a>
        <a href="#web-search">Web Search & Scraping</a>
        <a href="#pdf">PDF Generation</a>
        <a href="#presets">Presets</a>
        <a href="#tips">Power-User Tips</a>

        <h3>Reference</h3>
        <a href="tools.html">All 58 Tools</a>
        <a href="modules.html">Modules</a>
        <a href="agents.html">Agents & Skills</a>
    </aside>

    <main class="docs-content">
        <h1>Advanced Usage</h1>
        <p class="subtitle">
            Autonomous workflows, self-correcting callbacks, web research,
            PDF generation, and tips for getting the most out of Context Pilot.
        </p>

        <h2 id="autonomous">Autonomous Workflows</h2>
        <p>
            Context Pilot can work autonomously ‚Äî the AI continues working through a todo list
            without waiting for your input after each step. This is powered by the Spine module.
        </p>

        <h3>Setting up autonomous mode</h3>
        <ol>
            <li>Create a todo list with <code>todo_create</code> ‚Äî break your task into subtasks</li>
            <li>Enable auto-continuation: <code>spine_configure(continue_until_todos_done: true)</code></li>
            <li>Set guard rails to prevent runaway AI:
                <pre><code>spine_configure(
    max_cost: 2.00,           // Stop after $2 spent
    max_messages: 100,        // Stop after 100 messages
    max_duration_secs: 1800,  // Stop after 30 minutes
    max_auto_retries: 20      // Stop after 20 auto-continuations
)</code></pre>
            </li>
            <li>The AI works through todos, marking them done, until all are complete or a guard rail triggers</li>
        </ol>

        <div class="callout callout-warning">
            <strong>‚ö†Ô∏è Always set guard rails</strong>
            Without limits, the AI could loop indefinitely. Start with conservative limits and increase as you build confidence.
        </div>

        <h3>Monitoring autonomous work</h3>
        <p>
            The Spine panel (P7) shows notifications, auto-continuation count, and guard rail status.
            Press <code>Esc</code> at any time to stop the AI mid-generation. The Todo panel shows
            progress in real-time.
        </p>

        <h2 id="callbacks">File Edit Callbacks</h2>
        <p>
            Callbacks are the secret weapon: bash scripts that automatically fire when the AI
            edits files matching a glob pattern. They create a self-correcting feedback loop.
        </p>

        <h3>Creating a callback</h3>
        <pre><code>Callback_upsert(
    action: "create",
    name: "rust-check",
    pattern: "*.rs",
    script_content: "cargo check 2>&1",
    blocking: true,
    timeout: 30,
    success_message: "Build passed ‚úì"
)</code></pre>

        <h3>How it works</h3>
        <ol>
            <li>AI edits a <code>.rs</code> file via <code>Edit</code> or <code>Write</code></li>
            <li>The <code>rust-check</code> callback fires automatically</li>
            <li>In <strong>blocking mode</strong>, the AI waits for the result</li>
            <li>If the check fails, the AI sees the error output and self-corrects</li>
            <li>If it passes, the AI sees the success message and continues</li>
        </ol>

        <h3>Advanced callback features</h3>
        <ul>
            <li><strong>Blocking mode</strong> ‚Äî AI pauses until the callback completes</li>
            <li><strong>One-at-a-time</strong> ‚Äî prevents simultaneous runs of the same callback</li>
            <li><strong>Timeout</strong> ‚Äî kills callbacks that run too long</li>
            <li><strong>Exit code 7</strong> ‚Äî silently suppresses output (for "not applicable" cases)</li>
            <li><strong>skip_callbacks</strong> ‚Äî bypass specific callbacks on individual edits</li>
            <li><strong>$CP_CHANGED_FILES</strong> ‚Äî environment variable with the list of changed files</li>
        </ul>

        <h2 id="web-search">Web Search & Scraping</h2>
        <p>
            With API keys configured, the AI can search the web and scrape pages.
            Tools follow an escalation tier system ‚Äî start cheap, go deeper only if needed.
        </p>

        <h3>Escalation tiers</h3>
        <table>
            <thead><tr><th>Tier</th><th>Tool</th><th>When to use</th></tr></thead>
            <tbody>
                <tr><td>1</td><td><code>brave_search</code></td><td>Quick facts, snippets ‚Äî always try first</td></tr>
                <tr><td>2</td><td><code>brave_llm_context</code></td><td>Need more depth from search results</td></tr>
                <tr><td>3a</td><td><code>firecrawl_scrape</code></td><td>Full page from a known URL</td></tr>
                <tr><td>3b</td><td><code>firecrawl_search</code></td><td>Search + scrape in one call</td></tr>
                <tr><td>4</td><td><code>firecrawl_map</code></td><td>Discover URLs on a domain</td></tr>
            </tbody>
        </table>

        <h3>Brave Goggles</h3>
        <p>
            Load the built-in "Brave Goggles" skill (<code>skill_load("brave-goggles")</code>)
            for curated domain re-ranking goggles ‚Äî tech blogs, HN, academic sources, and more.
        </p>

        <h2 id="pdf">PDF Generation</h2>
        <p>
            Context Pilot embeds the Typst compiler ‚Äî create professional PDFs from code without
            any external tools.
        </p>

        <h3>Quick start</h3>
        <pre><code># Create a document
Write("report.typ", "#set page(paper: \"a4\")\n= My Report\nHello world")

# Compile to PDF
typst_execute("typst compile report.typ")

# Watch for auto-recompile on edits
typst_execute("typst watch report.typ")</code></pre>

        <h3>Templates</h3>
        <p>
            Reusable templates live in <code>.context-pilot/shared/typst-templates/</code>.
            Import them in your documents. You can also scaffold from Typst Universe:
        </p>
        <pre><code>typst_execute("typst init @preview/brilliant-cv:2.0.3")</code></pre>

        <h2 id="presets">Presets</h2>
        <p>
            Presets save and restore your entire working configuration ‚Äî switch between
            different project contexts instantly.
        </p>

        <h3>Saving a preset</h3>
        <pre><code>preset_snapshot_myself(
    name: "my-rust-project",
    description: "Rust project with clippy callbacks and web search"
)</code></pre>

        <h3>Loading a preset</h3>
        <pre><code>preset_load(name: "my-rust-project")</code></pre>

        <p>Presets capture: active agent, modules, disabled tools, todos, scratchpad, callbacks, and panel configurations. Messages are preserved.</p>

        <h2 id="tips">Power-User Tips</h2>
        <ul>
            <li><strong>Use <code>@</code> autocomplete</strong> ‚Äî type <code>@</code> in the input to get shell-style file path completion with Tab navigation</li>
            <li><strong>Create slash commands</strong> ‚Äî <code>/review</code>, <code>/deploy</code>, <code>/test</code> for common prompts</li>
            <li><strong>Stack callbacks</strong> ‚Äî combine <code>cargo check</code> (blocking) + <code>cargo clippy</code> (blocking) + <code>cargo test</code> (async) for a full CI pipeline on every edit</li>
            <li><strong>Use memories for conventions</strong> ‚Äî "Always use explicit error handling", "Run tests before committing" ‚Äî the AI follows them every session</li>
            <li><strong>Close stale panels</strong> ‚Äî the AI can close panels to free context space. Ask it to clean up if things feel cluttered</li>
            <li><strong>Use <code>coucou</code> for reminders</strong> ‚Äî schedule a notification to check on a long-running process</li>
            <li><strong>Conversation history</strong> ‚Äî when context gets large, ask the AI to close old history panels (it preserves important info as logs/memories first)</li>
        </ul>
    </main>
</div>

<footer class="footer">
    <div class="footer-inner">
        <p>Built with ü¶Ä Rust and ‚ù§Ô∏è by the Context Pilot contributors. <a href="https://github.com/bigmoostache/context-pilot" target="_blank">GitHub</a></p>
    </div>
</footer>

</body>
</html>
