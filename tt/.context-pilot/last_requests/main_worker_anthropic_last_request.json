{
  "model": "claude-opus-4-5",
  "max_tokens": 128000,
  "system": "You are a helpful coding assistant.\n\nIMPORTANT: Messages in context have ID prefixes like [U1], [A1], [R1] for internal tracking.\nThese are for context management only - NEVER include these prefixes in your responses.\nJust respond naturally without any [Axxx] or similar prefixes.\n",
  "messages": [
    {
      "role": "assistant",
      "content": [
        {
          "type": "text",
          "text": "Beginning of dynamic panel display. All content displayed below may be considered up to date.\n\nPanel automatically generated at 2026-02-25T17:33:49Z"
        },
        {
          "type": "tool_use",
          "id": "panel_P1",
          "name": "dynamic_panel",
          "input": {
            "id": "P1"
          }
        }
      ]
    },
    {
      "role": "user",
      "content": [
        {
          "type": "tool_result",
          "tool_use_id": "panel_P1",
          "content": "======= [P1] Todo List =======\nNo todos"
        }
      ]
    },
    {
      "role": "assistant",
      "content": [
        {
          "type": "text",
          "text": "Panel automatically generated at 2026-02-25T17:33:49Z"
        },
        {
          "type": "tool_use",
          "id": "panel_P6",
          "name": "dynamic_panel",
          "input": {
            "id": "P6"
          }
        }
      ]
    },
    {
      "role": "user",
      "content": [
        {
          "type": "tool_result",
          "tool_use_id": "panel_P6",
          "content": "======= [P6] Memories =======\nNo memories"
        }
      ]
    },
    {
      "role": "assistant",
      "content": [
        {
          "type": "text",
          "text": "Panel automatically generated at 2026-02-25T17:33:49Z"
        },
        {
          "type": "tool_use",
          "id": "panel_P8",
          "name": "dynamic_panel",
          "input": {
            "id": "P8"
          }
        }
      ]
    },
    {
      "role": "user",
      "content": [
        {
          "type": "tool_result",
          "tool_use_id": "panel_P8",
          "content": "======= [P8] Logs =======\nNo logs"
        }
      ]
    },
    {
      "role": "assistant",
      "content": [
        {
          "type": "text",
          "text": "Panel automatically generated at 2026-02-25T17:33:49Z"
        },
        {
          "type": "tool_use",
          "id": "panel_P9",
          "name": "dynamic_panel",
          "input": {
            "id": "P9"
          }
        }
      ]
    },
    {
      "role": "user",
      "content": [
        {
          "type": "tool_result",
          "tool_use_id": "panel_P9",
          "content": "======= [P9] Callbacks =======\n| ID | Name | Pattern | Description | Blocking | Timeout | Active | 1-at-a-time | Success Msg | CWD |\n|------|------|---------|-------------|----------|---------|--------|-------------|-------------|-----|\n| CB1 | typst-watchlist | * | Recompile watched .typ documents when their dependencies change | yes | 60s | ✓ | no | — | project root |"
        }
      ]
    },
    {
      "role": "assistant",
      "content": [
        {
          "type": "text",
          "text": "Panel automatically generated at 2026-02-25T17:33:49Z"
        },
        {
          "type": "tool_use",
          "id": "panel_P10",
          "name": "dynamic_panel",
          "input": {
            "id": "P10"
          }
        }
      ]
    },
    {
      "role": "user",
      "content": [
        {
          "type": "tool_result",
          "tool_use_id": "panel_P10",
          "content": "======= [P10] Scratchpad =======\nNo scratchpad cells"
        }
      ]
    },
    {
      "role": "assistant",
      "content": [
        {
          "type": "text",
          "text": "Panel automatically generated at 2026-02-25T17:33:49Z"
        },
        {
          "type": "tool_use",
          "id": "panel_P5",
          "name": "dynamic_panel",
          "input": {
            "id": "P5"
          }
        }
      ]
    },
    {
      "role": "user",
      "content": [
        {
          "type": "tool_result",
          "tool_use_id": "panel_P5",
          "content": "======= [P5] Directory Tree =======\npwd: /home/gdraznieks/Bureau/context-pilot/tt\n└── ▶ .context-pilot/ \n"
        }
      ]
    },
    {
      "role": "assistant",
      "content": [
        {
          "type": "text",
          "text": "Panel automatically generated at 2026-02-25T17:34:11Z"
        },
        {
          "type": "tool_use",
          "id": "panel_P2",
          "name": "dynamic_panel",
          "input": {
            "id": "P2"
          }
        }
      ]
    },
    {
      "role": "user",
      "content": [
        {
          "type": "tool_result",
          "tool_use_id": "panel_P2",
          "content": "======= [P2] Library =======\nAgents (system prompts):\n\n| ID | Name | Active | Description |\n|------|------|--------|-------------|\n| default | Default | ✓ | Default coding assistant |\n| context-builder | Context Builder |  | Codebase exploration and understanding assistant |\n| context-cleaner | Context Cleaner |  | Context management and hygiene assistant |\n| planner | Planner |  | Task planning and breakdown assistant |\n| worker | Worker |  | Focused implementation and testing assistant |\n\nSkills (use skill_load/skill_unload):\n\n| ID | Name | Loaded | Description |\n|------|------|--------|-------------|\n| brave-goggles | Brave Goggles |  | Curated Brave Search Goggles for domain re-ranking |\n"
        }
      ]
    },
    {
      "role": "assistant",
      "content": [
        {
          "type": "text",
          "text": "Panel automatically generated at 2026-02-25T17:34:11Z"
        },
        {
          "type": "tool_use",
          "id": "panel_P7",
          "name": "dynamic_panel",
          "input": {
            "id": "P7"
          }
        }
      ]
    },
    {
      "role": "user",
      "content": [
        {
          "type": "tool_result",
          "tool_use_id": "panel_P7",
          "content": "======= [P7] Spine =======\nNo unprocessed notifications.\n\n=== Recent Processed ===\n[N1] 17:34:11 User Message — activate auto continuation and create a todo please. \n\n\n=== Spine Config ===\ncontinue_until_todos_done: false\nauto_continuation_count: 1"
        }
      ]
    },
    {
      "role": "assistant",
      "content": [
        {
          "type": "text",
          "text": "Panel automatically generated at 2026-02-25T17:34:11Z"
        },
        {
          "type": "tool_use",
          "id": "panel_P4",
          "name": "dynamic_panel",
          "input": {
            "id": "P4"
          }
        }
      ]
    },
    {
      "role": "user",
      "content": [
        {
          "type": "tool_result",
          "tool_use_id": "panel_P4",
          "content": "======= [P4] Tools =======\nTools (57 enabled, 1 disabled):\n\n| Category | Tool | Status | Description |\n|----------|------|--------|-------------|\n| Context | Close_panel | ✓ | Remove items from context |\n| System | system_reload | ✓ | Restart the TUI |\n| System | tool_manage | ✓ | Enable/disable tools |\n| Context | panel_goto_page | ✗ | Navigate paginated panel |\n| System | module_toggle | ✓ | Activate/deactivate modules |\n| Context | ask_user_question | ✓ | Ask user multiple-choice questions |\n| Agent | agent_create | ✓ | Create agent (system prompt) |\n| Agent | Edit_prompt | ✓ | Edit agent/skill/command content |\n| Agent | agent_delete | ✓ | Delete agent |\n| Agent | agent_load | ✓ | Activate agent |\n| Skill | skill_create | ✓ | Create skill |\n| Skill | skill_delete | ✓ | Delete skill |\n| Skill | skill_load | ✓ | Load skill as panel |\n| Skill | skill_unload | ✓ | Unload skill panel |\n| Agent | Library_open_prompt_editor | ✓ | Open prompt in editor |\n| Agent | Library_close_prompt_editor | ✓ | Close prompt editor |\n| Command | command_create | ✓ | Create command |\n| Command | command_delete | ✓ | Delete command |\n| File | Open | ✓ | Read file into context |\n| File | Edit | ✓ | Modify file content |\n| File | Write | ✓ | Create or overwrite file |\n| Tree | tree_filter | ✓ | Configure directory filter |\n| Tree | tree_toggle | ✓ | Open/close folders |\n| Tree | tree_describe | ✓ | Add file/folder descriptions |\n| Git | git_execute | ✓ | Run git commands |\n| Git | gh_execute | ✓ | Run gh commands |\n| Console | console_create | ✓ | Spawn a new process |\n| Console | console_send_keys | ✓ | Send input to process |\n| Console | console_wait | ✓ | Wait for process event |\n| Console | console_watch | ✓ | Async watch for process event |\n| Console | console_easy_bash | ✓ | Run a command and return output |\n| Callback | Callback_upsert | ✓ | Create, update, or delete a callback |\n| Callback | Callback_open_editor | ✓ | Open callback script in editor |\n| Callback | Callback_close_editor | ✓ | Close callback script editor |\n| Callback | Callback_toggle | ✓ | Activate/deactivate a callback for this worker |\n| Todo | todo_create | ✓ | Add task items |\n| Todo | todo_update | ✓ | Modify task items |\n| Todo | todo_move | ✓ | Reorder a task |\n| Memory | memory_create | ✓ | Store persistent memories |\n| Memory | memory_update | ✓ | Modify stored notes |\n| Scratchpad | scratchpad_create_cell | ✓ | Add scratchpad cell |\n| Scratchpad | scratchpad_edit_cell | ✓ | Modify scratchpad cell |\n| Scratchpad | scratchpad_wipe | ✓ | Delete scratchpad cells |\n| System | preset_snapshot_myself | ✓ | Save current config |\n| System | preset_load | ✓ | Load saved config |\n| Spine | notification_mark_processed | ✓ | Mark notification as handled |\n| Spine | spine_configure | ✓ | Configure auto-continuation and guard rails |\n| Spine | coucou | ✓ | Schedule a reminder notification |\n| Context | log_create | ✓ | Create timestamped log entries |\n| Context | log_summarize | ✓ | Summarize multiple logs into a parent log |\n| Context | log_toggle | ✓ | Expand or collapse a log summary |\n| Context | Close_conversation_history | ✓ | Close a conversation history panel with logs/memories |\n| PDF | typst_execute | ✓ | Run typst commands via embedded compiler |\n| Web Search | brave_search | ✓ | Search the web via Brave |\n| Web Search | brave_llm_context | ✓ | Get LLM-optimized web content from Brave |\n| Web Scrape | firecrawl_scrape | ✓ | Scrape a URL for full content |\n| Web Scrape | firecrawl_search | ✓ | Search and scrape in one call |\n| Web Scrape | firecrawl_map | ✓ | Discover all URLs on a domain |\n"
        }
      ]
    },
    {
      "role": "assistant",
      "content": [
        {
          "type": "text",
          "text": "Panel automatically generated at 2026-02-25T17:34:12Z"
        },
        {
          "type": "tool_use",
          "id": "panel_P3",
          "name": "dynamic_panel",
          "input": {
            "id": "P3"
          }
        }
      ]
    },
    {
      "role": "user",
      "content": [
        {
          "type": "tool_result",
          "tool_use_id": "panel_P3",
          "content": "======= [P3] Statistics =======\nContext Usage: 12807 / 140000 threshold / 200000 budget (6.4%)\n\nContext Elements:\n  -- system-prompt (×2): 172 tokens (acc: 172)\n  -- tool-definitions (57 enabled): 10174 tokens (acc: 10346)\n  P1 wip: 3 tokens $0.00 ✓ (acc: 10349)\n  P6 memories: 4 tokens $0.00 ✓ (acc: 10353)\n  P8 logs: 3 tokens $0.00 ✓ (acc: 10356)\n  P9 callback (callbacks): 105 tokens $0.00 ✓ (acc: 10461)\n  P10 scratch: 6 tokens $0.00 ✓ (acc: 10467)\n  P5 tree: 24 tokens $0.00 ✓ (acc: 10491)\n  P2 library: 205 tokens $0.00 ✓ (acc: 10696)\n  P7 spine: 68 tokens $0.00 ✓ (acc: 10764)\n  P4 tools: 1122 tokens $0.01 ✓ (acc: 11886)\n  P3 world: 904 tokens $0.02 ✗ (acc: 12790)\n  chat chat: 17 tokens $0.00 ✗ (acc: 12807)\n\nMessages: 2 (1 user, 1 assistant)\n\nGit Branch: master\n\nGit Changes:\n\n| File | + | - | Net |\n|------|---|---|-----|\n| .context-pilot/config.json | +82 | -0 | +82 |\n| .context-pilot/console/server.pid | +1 | -0 | +1 |\n| .context-pilot/errors/error_1.txt | +10 | -0 | +10 |\n| .context-pilot/errors/error_2.txt | +10 | -0 | +10 |\n| .context-pilot/errors/error_3.txt | +10 | -0 | +10 |\n| .context-pilot/last_requests/main_worker_anthropic_last_request.json | +1937 | -0 | +1937 |\n| .context-pilot/logs/next_id.json | +3 | -0 | +3 |\n| .context-pilot/messages/UID_11_U.yaml | +9 | -0 | +9 |\n| .context-pilot/panels/UID_10_P.json | +8 | -0 | +8 |\n| .context-pilot/panels/UID_1_P.json | +11 | -0 | +11 |\n| .context-pilot/panels/UID_2_P.json | +8 | -0 | +8 |\n| .context-pilot/panels/UID_3_P.json | +9 | -0 | +9 |\n| .context-pilot/panels/UID_4_P.json | +9 | -0 | +9 |\n| .context-pilot/panels/UID_5_P.json | +9 | -0 | +9 |\n| .context-pilot/panels/UID_6_P.json | +8 | -0 | +8 |\n| .context-pilot/panels/UID_7_P.json | +8 | -0 | +8 |\n| .context-pilot/panels/UID_8_P.json | +8 | -0 | +8 |\n| .context-pilot/panels/UID_9_P.json | +8 | -0 | +8 |\n| .context-pilot/presets/admin.json | +26 | -0 | +26 |\n| .context-pilot/presets/context-builder.json | +26 | -0 | +26 |\n| .context-pilot/presets/context-cleaner.json | +28 | -0 | +28 |\n| .context-pilot/presets/planner.json | +30 | -0 | +30 |\n| .context-pilot/presets/worker.json | +34 | -0 | +34 |\n| .context-pilot/shared/typst-templates/invoice.typ | +73 | -0 | +73 |\n| .context-pilot/shared/typst-templates/letter.typ | +57 | -0 | +57 |\n| .context-pilot/shared/typst-templates/report.typ | +48 | -0 | +48 |\n| .context-pilot/states/main_worker.json | +88 | -0 | +88 |\n| **Total** | **+2558** | **-0** | **+2558** |\n\nPresets:\n\n| Name | Type | Description |\n|------|------|-------------|\n| admin | built-in | Full access to all modules and tools. Unrestricted configuration. |\n| context-builder | built-in | All modules active with a clean slate. Full exploration mode. |\n| context-cleaner | built-in | Minimal read-only mode for context management. Disables write tools. |\n| planner | built-in | Planning mode with todo and scratchpad. Disables file write and git push tools. |\n| worker | built-in | Implementation and testing mode. File editing, git, and console. No exploration or planning tools. |\n"
        }
      ]
    },
    {
      "role": "assistant",
      "content": [
        {
          "type": "text",
          "text": "End of dynamic panel displays. All content displayed above may be considered up to date: it is automatically kept updated as we speak.\n\nLast message datetimes:\n  - user: 2026-02-25T17:34:11Z (0 seconds ago)\n\nCurrent datetime: 2026-02-25T17:34:12Z\n"
        },
        {
          "type": "tool_use",
          "id": "panel_footer",
          "name": "dynamic_panel",
          "input": {
            "action": "end_panels"
          }
        }
      ]
    },
    {
      "role": "user",
      "content": [
        {
          "type": "tool_result",
          "tool_use_id": "panel_footer",
          "content": "Panel display complete. Proceeding with conversation."
        }
      ]
    },
    {
      "role": "user",
      "content": [
        {
          "type": "text",
          "text": "System instructions (repeated for emphasis):\n\nYou are a helpful coding assistant.\n\nIMPORTANT: Messages in context have ID prefixes like [U1], [A1], [R1] for internal tracking.\nThese are for context management only - NEVER include these prefixes in your responses.\nJust respond naturally without any [Axxx] or similar prefixes.\n"
        }
      ]
    },
    {
      "role": "assistant",
      "content": [
        {
          "type": "text",
          "text": "Understood. I will follow these instructions."
        }
      ]
    },
    {
      "role": "user",
      "content": [
        {
          "type": "text",
          "text": "activate auto continuation and create a todo please. \n"
        }
      ]
    }
  ],
  "tools": [
    {
      "description": "Closes context elements by their IDs (e.g., P6, P7). Cannot close core elements (P1-P6).",
      "input_schema": {
        "properties": {
          "ids": {
            "description": "List of context IDs to close",
            "items": {
              "type": "string"
            },
            "type": "array"
          }
        },
        "required": [
          "ids"
        ],
        "type": "object"
      },
      "name": "Close_panel"
    },
    {
      "description": "Reloads the TUI application to apply changes. Use after modifying TUI source code and rebuilding. State is preserved. IMPORTANT: You must ALWAYS call this tool after building - never just say 'reloading' without actually invoking this tool.",
      "input_schema": {
        "properties": {},
        "required": [],
        "type": "object"
      },
      "name": "system_reload"
    },
    {
      "description": "Enables or disables tools. This tool cannot be disabled. Use to customize available capabilities.",
      "input_schema": {
        "properties": {
          "changes": {
            "description": "Array of tool changes",
            "items": {
              "properties": {
                "action": {
                  "description": "Action to perform",
                  "enum": [
                    "enable",
                    "disable"
                  ],
                  "type": "string"
                },
                "tool": {
                  "description": "Tool ID to change (e.g., 'edit_file', 'glob')",
                  "type": "string"
                }
              },
              "required": [
                "tool",
                "action"
              ],
              "type": "object"
            },
            "type": "array"
          }
        },
        "required": [
          "changes"
        ],
        "type": "object"
      },
      "name": "tool_manage"
    },
    {
      "description": "Activates or deactivates modules. Core module cannot be deactivated. Deactivating a module removes its tools and panels. Cannot deactivate a module if another active module depends on it.",
      "input_schema": {
        "properties": {
          "changes": {
            "description": "Array of module changes",
            "items": {
              "properties": {
                "action": {
                  "description": "Action to perform",
                  "enum": [
                    "activate",
                    "deactivate"
                  ],
                  "type": "string"
                },
                "module": {
                  "description": "Module ID (e.g., 'git', 'memory', 'tmux')",
                  "type": "string"
                }
              },
              "required": [
                "module",
                "action"
              ],
              "type": "object"
            },
            "type": "array"
          }
        },
        "required": [
          "changes"
        ],
        "type": "object"
      },
      "name": "module_toggle"
    },
    {
      "description": "Presents 1-4 multiple-choice questions to the user as an interactive form. The form replaces the input field until the user submits answers or presses Esc to dismiss. Each question has 2-4 options plus an auto-appended \"Other\" free-text option. Use this to gather preferences, clarify ambiguous instructions, or get implementation decisions. The user can select one option (or multiple if multiSelect), or choose \"Other\" and type a custom answer. If recommending a specific option, list it first with \"(Recommended)\" in the label.",
      "input_schema": {
        "properties": {
          "questions": {
            "description": "1-4 questions to ask the user",
            "items": {
              "properties": {
                "header": {
                  "description": "Very short label (max 12 chars). E.g. \"Auth method\", \"Library\"",
                  "type": "string"
                },
                "multiSelect": {
                  "description": "If true, user can select multiple options",
                  "type": "boolean"
                },
                "options": {
                  "description": "2-4 available choices. An \"Other\" free-text option is appended automatically.",
                  "items": {
                    "properties": {
                      "description": {
                        "description": "Explanation of what this option means",
                        "type": "string"
                      },
                      "label": {
                        "description": "Display text (1-5 words)",
                        "type": "string"
                      }
                    },
                    "required": [
                      "label",
                      "description"
                    ],
                    "type": "object"
                  },
                  "type": "array"
                },
                "question": {
                  "description": "The complete question text. Should be clear, specific, and end with ?",
                  "type": "string"
                }
              },
              "required": [
                "question",
                "header",
                "options",
                "multiSelect"
              ],
              "type": "object"
            },
            "type": "array"
          }
        },
        "required": [
          "questions"
        ],
        "type": "object"
      },
      "name": "ask_user_question"
    },
    {
      "description": "Creates a new agent with a name, description, and system prompt content. Agents define the AI's identity and behavior. ID is auto-generated from the name.",
      "input_schema": {
        "properties": {
          "content": {
            "description": "System prompt content",
            "type": "string"
          },
          "description": {
            "description": "Short description",
            "type": "string"
          },
          "name": {
            "description": "Agent name",
            "type": "string"
          }
        },
        "required": [
          "name",
          "content"
        ],
        "type": "object"
      },
      "name": "agent_create"
    },
    {
      "description": "Edits an agent, skill, or command by replacing exact text in its content. Routes automatically based on ID. Uses the same old_string/new_string pattern as the file Edit tool.",
      "input_schema": {
        "properties": {
          "id": {
            "description": "Agent, skill, or command ID",
            "type": "string"
          },
          "new_string": {
            "description": "Replacement text",
            "type": "string"
          },
          "old_string": {
            "description": "Exact text to find and replace in content",
            "type": "string"
          },
          "replace_all": {
            "description": "Replace all occurrences (default: false)",
            "type": "boolean"
          }
        },
        "required": [
          "id",
          "old_string",
          "new_string"
        ],
        "type": "object"
      },
      "name": "Edit_prompt"
    },
    {
      "description": "Deletes an agent. Built-in agents cannot be deleted. If the deleted agent was active, reverts to default.",
      "input_schema": {
        "properties": {
          "id": {
            "description": "Agent ID to delete",
            "type": "string"
          }
        },
        "required": [
          "id"
        ],
        "type": "object"
      },
      "name": "agent_delete"
    },
    {
      "description": "Activates an agent as the current system prompt. Pass empty id to revert to default.",
      "input_schema": {
        "properties": {
          "id": {
            "description": "Agent ID to activate. Empty to use default.",
            "type": "string"
          }
        },
        "required": [],
        "type": "object"
      },
      "name": "agent_load"
    },
    {
      "description": "Creates a new skill. Skills are loaded as context panels that provide additional instructions or knowledge to the AI.",
      "input_schema": {
        "properties": {
          "content": {
            "description": "Skill content (instructions/knowledge)",
            "type": "string"
          },
          "description": {
            "description": "Short description",
            "type": "string"
          },
          "name": {
            "description": "Skill name",
            "type": "string"
          }
        },
        "required": [
          "name",
          "content"
        ],
        "type": "object"
      },
      "name": "skill_create"
    },
    {
      "description": "Deletes a skill. If loaded, unloads it first. Built-in skills cannot be deleted.",
      "input_schema": {
        "properties": {
          "id": {
            "description": "Skill ID to delete",
            "type": "string"
          }
        },
        "required": [
          "id"
        ],
        "type": "object"
      },
      "name": "skill_delete"
    },
    {
      "description": "Loads a skill as a context panel. The skill's content becomes visible to the AI as a context block.",
      "input_schema": {
        "properties": {
          "id": {
            "description": "Skill ID to load",
            "type": "string"
          }
        },
        "required": [
          "id"
        ],
        "type": "object"
      },
      "name": "skill_load"
    },
    {
      "description": "Unloads a skill, removing its context panel.",
      "input_schema": {
        "properties": {
          "id": {
            "description": "Skill ID to unload",
            "type": "string"
          }
        },
        "required": [
          "id"
        ],
        "type": "object"
      },
      "name": "skill_unload"
    },
    {
      "description": "Opens a prompt's content in the Library panel for reading and editing. Required before using Edit_prompt. Max one prompt open at a time — opening a new one closes the previous. The Library panel will show the prompt content with a warning banner.",
      "input_schema": {
        "properties": {
          "id": {
            "description": "Agent, skill, or command ID to open",
            "type": "string"
          }
        },
        "required": [
          "id"
        ],
        "type": "object"
      },
      "name": "Library_open_prompt_editor"
    },
    {
      "description": "Closes the prompt editor in the Library panel, restoring the normal library view.",
      "input_schema": {
        "properties": {},
        "required": [],
        "type": "object"
      },
      "name": "Library_close_prompt_editor"
    },
    {
      "description": "Creates a new command. Commands are inline replacements triggered by /command-name in the input field.",
      "input_schema": {
        "properties": {
          "content": {
            "description": "Content to replace the /command with",
            "type": "string"
          },
          "description": {
            "description": "Short description",
            "type": "string"
          },
          "name": {
            "description": "Command name",
            "type": "string"
          }
        },
        "required": [
          "name",
          "content"
        ],
        "type": "object"
      },
      "name": "command_create"
    },
    {
      "description": "Deletes a command. Built-in commands cannot be deleted.",
      "input_schema": {
        "properties": {
          "id": {
            "description": "Command ID to delete",
            "type": "string"
          }
        },
        "required": [
          "id"
        ],
        "type": "object"
      },
      "name": "command_delete"
    },
    {
      "description": "Opens a file and adds it to context so you can see its content. ALWAYS use this BEFORE file_edit to see current content - you need exact text for edits.",
      "input_schema": {
        "properties": {
          "path": {
            "description": "Path to the file to open",
            "type": "string"
          }
        },
        "required": [
          "path"
        ],
        "type": "object"
      },
      "name": "Open"
    },
    {
      "description": "Edits a file by replacing exact text. PREFERRED over file_write for any modification — only use file_write to create new files or completely replace all content. IMPORTANT: 1) Use file_open FIRST to see current content. 2) old_string must be EXACT text from file (copy from context). 3) To append, use the last line as old_string and include it + new content in new_string.",
      "input_schema": {
        "properties": {
          "file_path": {
            "description": "Absolute path to the file to edit",
            "type": "string"
          },
          "new_string": {
            "description": "Replacement text",
            "type": "string"
          },
          "old_string": {
            "description": "Exact text to find and replace (copy from file context)",
            "type": "string"
          },
          "replace_all": {
            "description": "Replace all occurrences (default: false)",
            "type": "boolean"
          },
          "skip_callbacks": {
            "description": "List of callback names to skip for this edit. Use sparingly — only when you KNOW the callback will fail (e.g. mid-refactor) or when actively debugging. Callbacks exist to help you; prefer letting them run.",
            "items": {
              "type": "string"
            },
            "type": "array"
          }
        },
        "required": [
          "file_path",
          "old_string",
          "new_string"
        ],
        "type": "object"
      },
      "name": "Edit"
    },
    {
      "description": "Writes complete contents to a file, creating it if it doesn't exist or replacing all content if it does. Use ONLY for creating new files or completely replacing file content. For targeted edits (changing specific sections, appending, inserting), ALWAYS prefer file_edit instead — it is safer and more precise.",
      "input_schema": {
        "properties": {
          "contents": {
            "description": "Complete file contents to write",
            "type": "string"
          },
          "file_path": {
            "description": "Path to the file to write",
            "type": "string"
          },
          "skip_callbacks": {
            "description": "List of callback names to skip for this write. Use sparingly — only when you KNOW the callback will fail (e.g. mid-refactor) or when actively debugging. Callbacks exist to help you; prefer letting them run.",
            "items": {
              "type": "string"
            },
            "type": "array"
          }
        },
        "required": [
          "file_path",
          "contents"
        ],
        "type": "object"
      },
      "name": "Write"
    },
    {
      "description": "Edits the gitignore-style filter for the directory tree view.",
      "input_schema": {
        "properties": {
          "filter": {
            "description": "Gitignore-style patterns, one per line",
            "type": "string"
          }
        },
        "required": [
          "filter"
        ],
        "type": "object"
      },
      "name": "tree_filter"
    },
    {
      "description": "Opens or closes folders in the directory tree view. Closed folders show child count, open folders show contents.",
      "input_schema": {
        "properties": {
          "action": {
            "description": "Action to perform",
            "enum": [
              "open",
              "close",
              "toggle"
            ],
            "type": "string"
          },
          "paths": {
            "description": "Folder paths to toggle (e.g., ['src', 'src/ui'])",
            "items": {
              "type": "string"
            },
            "type": "array"
          }
        },
        "required": [
          "paths"
        ],
        "type": "object"
      },
      "name": "tree_toggle"
    },
    {
      "description": "Adds or updates descriptions for files and folders in the tree. Descriptions appear next to items. A [!] marker indicates the file changed since description was written.",
      "input_schema": {
        "properties": {
          "descriptions": {
            "description": "Array of path descriptions",
            "items": {
              "properties": {
                "delete": {
                  "description": "Set true to remove description",
                  "type": "boolean"
                },
                "description": {
                  "description": "Description text",
                  "type": "string"
                },
                "path": {
                  "description": "File or folder path",
                  "type": "string"
                }
              },
              "required": [
                "path"
              ],
              "type": "object"
            },
            "type": "array"
          }
        },
        "required": [
          "descriptions"
        ],
        "type": "object"
      },
      "name": "tree_describe"
    },
    {
      "description": "Executes a git command. Read-only commands (log, diff, show, status, blame, etc.) create a dynamic result panel that auto-refreshes. Mutating commands (commit, push, pull, merge, rebase, etc.) execute directly and return output. Shell operators (|, ;, &&) are not allowed.",
      "input_schema": {
        "properties": {
          "command": {
            "description": "Full git command string (e.g., 'git log --oneline -10', 'git commit -m \"message\"')",
            "type": "string"
          }
        },
        "required": [
          "command"
        ],
        "type": "object"
      },
      "name": "git_execute"
    },
    {
      "description": "Executes a GitHub CLI (gh) command. Requires GITHUB_TOKEN in environment. Read-only commands (pr list, issue view, etc.) create a dynamic result panel that auto-refreshes every 120 seconds. Mutating commands (pr create, issue close, etc.) execute directly and return output. Shell operators (|, ;, &&) are not allowed.",
      "input_schema": {
        "properties": {
          "command": {
            "description": "Full gh command string (e.g., 'gh pr list', 'gh issue view 42')",
            "type": "string"
          }
        },
        "required": [
          "command"
        ],
        "type": "object"
      },
      "name": "gh_execute"
    },
    {
      "description": "Spawns a child process and creates a console panel to monitor its output. The process runs in the background and survives TUI reloads. Close the panel to kill the process. For one-shot commands (e.g. 'cargo build'), pass the full command directly — the panel shows output and exits when done. For interactive shells, pass 'bash' and use console_send_keys to run commands. For long-running servers (e.g. 'npm run dev'), combine with console_wait (block=false, mode='pattern') to get notified when ready.",
      "input_schema": {
        "properties": {
          "command": {
            "description": "Shell command to execute (e.g., 'npm run dev', 'cargo build 2>&1', 'bash')",
            "type": "string"
          },
          "cwd": {
            "description": "Working directory for the command (defaults to project root)",
            "type": "string"
          },
          "description": {
            "description": "Short description for the panel title",
            "type": "string"
          }
        },
        "required": [
          "command"
        ],
        "type": "object"
      },
      "name": "console_create"
    },
    {
      "description": "Sends input text to a running console's stdin. Use for interactive processes. Newline is NOT appended automatically — include \\n if needed. Typical usage: send a command followed by \\n (e.g. 'ls -la\\n'). For interactive prompts, send the expected response (e.g. 'yes\\n' or 'q'). Escape sequences are interpreted as control characters: \\x03 (Ctrl+C to interrupt), \\x04 (Ctrl+D for EOF), \\e[A (up arrow), \\n (newline), \\t (tab), \\xHH (arbitrary hex byte). To stop a process, send \\x03 (Ctrl+C) or close the panel.",
      "input_schema": {
        "properties": {
          "id": {
            "description": "Console panel ID (e.g., 'P11')",
            "type": "string"
          },
          "input": {
            "description": "Text to send to stdin (e.g., 'cargo test\\n' or 'yes\\n')",
            "type": "string"
          }
        },
        "required": [
          "id",
          "input"
        ],
        "type": "object"
      },
      "name": "console_send_keys"
    },
    {
      "description": "Registers a waiter for a console event. Two modes: mode='exit': waits for the process to exit (use for builds, one-shot commands). mode='pattern': waits for a regex pattern to match in output (use for server ready messages, specific log lines). Patterns are full regex — e.g. 'Listening on port \\d+', 'error|warning', 'Finished.*target'. Falls back to literal substring match if the regex is invalid. IMPORTANT: Include both success AND failure patterns using regex alternation (|) so you catch errors early instead of waiting for timeout. E.g. 'ready to accept|error|panic|failed'. BLOCKING: pauses tool execution until condition is met or max_wait expires. Best for sequential workflows (build then test). For async monitoring (long-running servers), use console_watch instead.",
      "input_schema": {
        "properties": {
          "id": {
            "description": "Console panel ID (e.g., 'P11')",
            "type": "string"
          },
          "max_wait": {
            "description": "Max wait in seconds, 1-30 (default: 30). On timeout, returns last output lines.",
            "type": "integer"
          },
          "mode": {
            "description": "Wait mode: 'exit' for process completion, 'pattern' for regex match in output",
            "enum": [
              "exit",
              "pattern"
            ],
            "type": "string"
          },
          "pattern": {
            "description": "Regex pattern to match in output (required when mode='pattern'). Use alternation to catch success AND failure: 'Listening on \\d+|error|panic|EADDRINUSE'. Falls back to literal match if invalid regex.",
            "type": "string"
          }
        },
        "required": [
          "id",
          "mode"
        ],
        "type": "object"
      },
      "name": "console_wait"
    },
    {
      "description": "Registers an async watcher for a console event. You continue working and get a spine notification when the condition is satisfied. Best for long-running processes where you don't want to block (e.g. dev servers, background tasks). Two modes: mode='exit': notifies when the process exits. mode='pattern': notifies when a regex pattern matches in output. If the condition is already met, returns immediately instead of registering a watcher. For blocking waits (sequential workflows), use console_wait instead.",
      "input_schema": {
        "properties": {
          "id": {
            "description": "Console panel ID (e.g., 'P11')",
            "type": "string"
          },
          "mode": {
            "description": "Watch mode: 'exit' for process completion, 'pattern' for regex match in output",
            "enum": [
              "exit",
              "pattern"
            ],
            "type": "string"
          },
          "pattern": {
            "description": "Regex pattern to match in output (required when mode='pattern'). Use alternation to catch success AND failure: 'Listening on \\d+|error|panic|EADDRINUSE'. Falls back to literal match if invalid regex.",
            "type": "string"
          }
        },
        "required": [
          "id",
          "mode"
        ],
        "type": "object"
      },
      "name": "console_watch"
    },
    {
      "description": "Runs a shell command synchronously and returns stdout+stderr directly. No server, no background process — just exec and return. Use for debugging and quick one-off commands. BLOCKING: freezes tool execution until command completes (max 10s, then killed). Do NOT use for long-running or interactive commands — use console_create instead.",
      "input_schema": {
        "properties": {
          "command": {
            "description": "Shell command to execute (e.g., 'ls -la', 'cat /tmp/foo')",
            "type": "string"
          },
          "cwd": {
            "description": "Working directory (defaults to project root)",
            "type": "string"
          }
        },
        "required": [
          "command"
        ],
        "type": "object"
      },
      "name": "console_easy_bash"
    },
    {
      "description": "Creates, updates, or deletes a file edit callback. Callbacks are bash scripts that auto-fire when the AI edits files matching a glob pattern. Use action='create' to define a new callback with its script. Use action='update' to modify an existing callback. Use action='delete' to remove a callback and its script file.",
      "input_schema": {
        "properties": {
          "action": {
            "description": "Action: 'create', 'update', or 'delete'",
            "enum": [
              "create",
              "update",
              "delete"
            ],
            "type": "string"
          },
          "blocking": {
            "description": "Block Edit/Write result until script completes (default: false)",
            "type": "boolean"
          },
          "cwd": {
            "description": "Working directory (defaults to project root)",
            "type": "string"
          },
          "description": {
            "description": "Short explanation of what this callback does",
            "type": "string"
          },
          "id": {
            "description": "Callback ID (required for update/delete, e.g. 'CB1')",
            "type": "string"
          },
          "name": {
            "description": "Display name (e.g., 'rust-check'). Required for create.",
            "type": "string"
          },
          "new_string": {
            "description": "For diff-based script update: replacement text",
            "type": "string"
          },
          "old_string": {
            "description": "For diff-based script update: exact text to find",
            "type": "string"
          },
          "one_at_a_time": {
            "description": "Don't run simultaneously with itself (default: false)",
            "type": "boolean"
          },
          "pattern": {
            "description": "Gitignore-style glob (e.g., '*.rs', 'src/**/*.ts'). Required for create.",
            "type": "string"
          },
          "script_content": {
            "description": "Bash script body (shebang auto-prepended). Required for create.",
            "type": "string"
          },
          "success_message": {
            "description": "Custom message on success (e.g., 'Build passed ✓')",
            "type": "string"
          },
          "timeout": {
            "description": "Max execution time in seconds (required if blocking)",
            "type": "integer"
          }
        },
        "required": [
          "action"
        ],
        "type": "object"
      },
      "name": "Callback_upsert"
    },
    {
      "description": "Opens a callback's script content in the Callbacks panel for reading and editing. Required before using diff-based script editing (old_string/new_string in Callback_upsert update). Max one callback open at a time — opening a new one closes the previous.",
      "input_schema": {
        "properties": {
          "id": {
            "description": "Callback ID (e.g., 'CB1')",
            "type": "string"
          }
        },
        "required": [
          "id"
        ],
        "type": "object"
      },
      "name": "Callback_open_editor"
    },
    {
      "description": "Closes the callback script editor in the Callbacks panel, restoring the normal table view.",
      "input_schema": {
        "properties": {},
        "required": [],
        "type": "object"
      },
      "name": "Callback_close_editor"
    },
    {
      "description": "Activates or deactivates a callback for the current worker. Does NOT modify the callback definition — only this worker's activation state.",
      "input_schema": {
        "properties": {
          "active": {
            "description": "true to activate, false to deactivate",
            "type": "boolean"
          },
          "id": {
            "description": "Callback ID (e.g., 'CB1')",
            "type": "string"
          }
        },
        "required": [
          "id",
          "active"
        ],
        "type": "object"
      },
      "name": "Callback_toggle"
    },
    {
      "description": "Creates one or more todo items. Supports nesting via parent_id.",
      "input_schema": {
        "properties": {
          "todos": {
            "description": "Array of todos to create",
            "items": {
              "properties": {
                "description": {
                  "description": "Detailed description",
                  "type": "string"
                },
                "name": {
                  "description": "Todo title",
                  "type": "string"
                },
                "parent_id": {
                  "description": "Parent todo ID for nesting",
                  "type": "string"
                }
              },
              "required": [
                "name"
              ],
              "type": "object"
            },
            "type": "array"
          }
        },
        "required": [
          "todos"
        ],
        "type": "object"
      },
      "name": "todo_create"
    },
    {
      "description": "Updates existing todos: change status, name, description, or delete. Use delete:true to remove a todo.",
      "input_schema": {
        "properties": {
          "updates": {
            "description": "Array of todo updates",
            "items": {
              "properties": {
                "delete": {
                  "description": "Set true to delete this todo",
                  "type": "boolean"
                },
                "description": {
                  "description": "New description",
                  "type": "string"
                },
                "id": {
                  "description": "Todo ID (e.g., X1)",
                  "type": "string"
                },
                "name": {
                  "description": "New name",
                  "type": "string"
                },
                "parent_id": {
                  "description": "New parent ID, or null to make top-level",
                  "type": "string"
                },
                "status": {
                  "description": "New status",
                  "enum": [
                    "pending",
                    "in_progress",
                    "done",
                    "deleted"
                  ],
                  "type": "string"
                }
              },
              "required": [
                "id"
              ],
              "type": "object"
            },
            "type": "array"
          }
        },
        "required": [
          "updates"
        ],
        "type": "object"
      },
      "name": "todo_update"
    },
    {
      "description": "Moves a todo to a new position in the list. Place it after another todo, or at the top if after_id is null.",
      "input_schema": {
        "properties": {
          "after_id": {
            "description": "Place after this todo ID. Null or omit to move to top.",
            "type": "string"
          },
          "id": {
            "description": "Todo ID to move (e.g., X1)",
            "type": "string"
          }
        },
        "required": [
          "id"
        ],
        "type": "object"
      },
      "name": "todo_move"
    },
    {
      "description": "Creates memory items for important information to remember across the conversation.",
      "input_schema": {
        "properties": {
          "memories": {
            "description": "Array of memories to create",
            "items": {
              "properties": {
                "content": {
                  "description": "Memory content",
                  "type": "string"
                },
                "contents": {
                  "description": "Rich body text (visible when memory is opened)",
                  "type": "string"
                },
                "importance": {
                  "description": "Importance level",
                  "enum": [
                    "low",
                    "medium",
                    "high",
                    "critical"
                  ],
                  "type": "string"
                },
                "labels": {
                  "description": "Freeform labels for categorization (e.g., ['architecture', 'bug'])",
                  "items": {
                    "type": "string"
                  },
                  "type": "array"
                }
              },
              "required": [
                "content"
              ],
              "type": "object"
            },
            "type": "array"
          }
        },
        "required": [
          "memories"
        ],
        "type": "object"
      },
      "name": "memory_create"
    },
    {
      "description": "Updates or deletes existing memory items.",
      "input_schema": {
        "properties": {
          "updates": {
            "description": "Array of memory updates",
            "items": {
              "properties": {
                "content": {
                  "description": "New content",
                  "type": "string"
                },
                "contents": {
                  "description": "New rich body text (visible when memory is opened)",
                  "type": "string"
                },
                "delete": {
                  "description": "Set true to delete",
                  "type": "boolean"
                },
                "id": {
                  "description": "Memory ID (e.g., M1)",
                  "type": "string"
                },
                "importance": {
                  "description": "New importance level",
                  "enum": [
                    "low",
                    "medium",
                    "high",
                    "critical"
                  ],
                  "type": "string"
                },
                "labels": {
                  "description": "New labels (replaces existing)",
                  "items": {
                    "type": "string"
                  },
                  "type": "array"
                },
                "open": {
                  "description": "Set true to show full contents in panel, false to show only tl;dr",
                  "type": "boolean"
                }
              },
              "required": [
                "id"
              ],
              "type": "object"
            },
            "type": "array"
          }
        },
        "required": [
          "updates"
        ],
        "type": "object"
      },
      "name": "memory_update"
    },
    {
      "description": "Creates a new scratchpad cell for storing temporary notes, code snippets, or data during the conversation.",
      "input_schema": {
        "properties": {
          "cell_contents": {
            "description": "Content to store in the cell",
            "type": "string"
          },
          "cell_title": {
            "description": "Title for the cell",
            "type": "string"
          }
        },
        "required": [
          "cell_title",
          "cell_contents"
        ],
        "type": "object"
      },
      "name": "scratchpad_create_cell"
    },
    {
      "description": "Edits an existing scratchpad cell. Can update title and/or contents.",
      "input_schema": {
        "properties": {
          "cell_contents": {
            "description": "New contents (omit to keep current)",
            "type": "string"
          },
          "cell_id": {
            "description": "Cell ID to edit (e.g., C1)",
            "type": "string"
          },
          "cell_title": {
            "description": "New title (omit to keep current)",
            "type": "string"
          }
        },
        "required": [
          "cell_id"
        ],
        "type": "object"
      },
      "name": "scratchpad_edit_cell"
    },
    {
      "description": "Deletes scratchpad cells by their IDs. Pass an empty array to wipe all cells.",
      "input_schema": {
        "properties": {
          "cell_ids": {
            "description": "Cell IDs to delete (e.g., ['C1', 'C2']). Empty array deletes all cells.",
            "items": {
              "type": "string"
            },
            "type": "array"
          }
        },
        "required": [
          "cell_ids"
        ],
        "type": "object"
      },
      "name": "scratchpad_wipe"
    },
    {
      "description": "Saves the current worker configuration as a named preset. Captures: active system prompt, active modules, disabled tools, per-worker module data (todos, scratchpad, git settings), and dynamic panels. Does NOT capture messages or global config.",
      "input_schema": {
        "properties": {
          "description": {
            "description": "Description of what this preset is for",
            "type": "string"
          },
          "name": {
            "description": "Preset name (alphanumeric and hyphens only, e.g., 'my-preset')",
            "type": "string"
          },
          "replace": {
            "description": "Name of existing preset to overwrite. Required if a preset with this name already exists.",
            "type": "string"
          }
        },
        "required": [
          "name",
          "description"
        ],
        "type": "object"
      },
      "name": "preset_snapshot_myself"
    },
    {
      "description": "Loads a named preset, replacing the current worker configuration. Replaces: active system prompt, active modules, disabled tools, per-worker module data, and dynamic panels. Messages and conversation history are preserved.",
      "input_schema": {
        "properties": {
          "name": {
            "description": "Name of the preset to load",
            "type": "string"
          }
        },
        "required": [
          "name"
        ],
        "type": "object"
      },
      "name": "preset_load"
    },
    {
      "description": "Marks a spine notification as processed, indicating you've addressed it.",
      "input_schema": {
        "properties": {
          "ids": {
            "description": "Notification IDs to mark as processed (e.g., ['N1', 'N2'])",
            "items": {
              "type": "string"
            },
            "type": "array"
          }
        },
        "required": [
          "ids"
        ],
        "type": "object"
      },
      "name": "notification_mark_processed"
    },
    {
      "description": "Configures the spine module's auto-continuation behavior and guard rail limits. All parameters are optional — only provided values are changed. Guard rail limits accept null to disable.",
      "input_schema": {
        "properties": {
          "continue_until_todos_done": {
            "description": "Keep auto-continuing until all todos are done (default: false)",
            "type": "boolean"
          },
          "max_auto_retries": {
            "description": "Guard rail: max consecutive auto-continuations without human input. Null to disable.",
            "type": "integer"
          },
          "max_cost": {
            "description": "Guard rail: max cost in USD before blocking. Null to disable.",
            "type": "number"
          },
          "max_duration_secs": {
            "description": "Guard rail: max autonomous duration in seconds. Null to disable.",
            "type": "integer"
          },
          "max_messages": {
            "description": "Guard rail: max conversation messages before blocking. Null to disable.",
            "type": "integer"
          },
          "max_output_tokens": {
            "description": "Guard rail: max total output tokens before blocking. Null to disable.",
            "type": "integer"
          },
          "reset_counters": {
            "description": "Reset runtime counters (auto_continuation_count, autonomous_start_ms)",
            "type": "boolean"
          }
        },
        "required": [],
        "type": "object"
      },
      "name": "spine_configure"
    },
    {
      "description": "Schedules a notification to fire after a delay (timer mode) or at a specific time (datetime mode). The notification appears in the Spine panel and triggers auto-continuation. Use for reminders, delayed checks, or timed follow-ups.",
      "input_schema": {
        "properties": {
          "datetime": {
            "description": "When to fire (datetime mode only). Format: YYYY-MM-DDTHH:MM:SS (local time)",
            "type": "string"
          },
          "delay": {
            "description": "Delay before firing (timer mode only). Examples: '30s', '5m', '1h30m', '2h15m30s'",
            "type": "string"
          },
          "message": {
            "description": "Message to deliver when the notification fires",
            "type": "string"
          },
          "mode": {
            "description": "Scheduling mode: 'timer' for relative delay, 'datetime' for absolute time",
            "type": "string"
          }
        },
        "required": [
          "mode",
          "message"
        ],
        "type": "object"
      },
      "name": "coucou"
    },
    {
      "description": "Creates timestamped log entries for recording decisions, actions, or notable events during the conversation.",
      "input_schema": {
        "properties": {
          "entries": {
            "description": "Array of log entries to create (timestamped automatically)",
            "items": {
              "properties": {
                "content": {
                  "description": "Short, atomic log entry",
                  "type": "string"
                }
              },
              "required": [
                "content"
              ],
              "type": "object"
            },
            "type": "array"
          }
        },
        "required": [
          "entries"
        ],
        "type": "object"
      },
      "name": "log_create"
    },
    {
      "description": "Summarizes multiple top-level log entries into a single parent summary log. The original logs become children hidden under the summary. Only top-level logs (no parent) can be summarized. Minimum 4 entries required.",
      "input_schema": {
        "properties": {
          "content": {
            "description": "Summary text for the new parent log entry",
            "type": "string"
          },
          "log_ids": {
            "description": "Array of log IDs to summarize (e.g., ['L27', 'L28', 'L29']). Minimum 4 entries. All must be top-level (no parent).",
            "items": {
              "type": "string"
            },
            "type": "array"
          }
        },
        "required": [
          "log_ids",
          "content"
        ],
        "type": "object"
      },
      "name": "log_summarize"
    },
    {
      "description": "Expands or collapses a log summary to show or hide its children. Can only toggle logs that have children (are summaries).",
      "input_schema": {
        "properties": {
          "action": {
            "description": "Action to perform",
            "enum": [
              "expand",
              "collapse"
            ],
            "type": "string"
          },
          "id": {
            "description": "Log ID to toggle (e.g., 'L42')",
            "type": "string"
          }
        },
        "required": [
          "id",
          "action"
        ],
        "type": "object"
      },
      "name": "log_toggle"
    },
    {
      "description": "Closes a conversation history panel. Before closing, creates log entries and memory items to preserve important information. Everything in the history panel will be lost after closing.\n\nIMPORTANT: Before calling this tool, carefully review ALL human messages in the panel. Extract and preserve:\n- **Logs**: Short, atomic entries for mid-conversation context — decisions made, actions taken, bugs found, user preferences expressed, task context. Logs are medium-lifecycle: they maintain conversation flow across reloads.\n- **Memories**: Longer-lived knowledge that matters beyond this session — architecture decisions, user preferences, project conventions, important discoveries. Memories persist across conversations.\n\nEvery substantive piece of information from human messages should be captured in either a log or a memory. When in doubt, preserve it. Log timestamps are set to the panel's last message time, not the current time.",
      "input_schema": {
        "properties": {
          "id": {
            "description": "ID of the conversation history panel to close (e.g., 'P12')",
            "type": "string"
          },
          "logs": {
            "description": "Log entries to create (timestamped automatically). Should be short, atomic things to remember from the conversation.",
            "items": {
              "properties": {
                "content": {
                  "description": "Short, atomic log entry to remember",
                  "type": "string"
                }
              },
              "required": [
                "content"
              ],
              "type": "object"
            },
            "type": "array"
          },
          "memories": {
            "description": "Memory items to create (persistent across conversations)",
            "items": {
              "properties": {
                "content": {
                  "description": "Memory content",
                  "type": "string"
                },
                "importance": {
                  "description": "Importance level",
                  "enum": [
                    "low",
                    "medium",
                    "high",
                    "critical"
                  ],
                  "type": "string"
                }
              },
              "required": [
                "content"
              ],
              "type": "object"
            },
            "type": "array"
          }
        },
        "required": [
          "id"
        ],
        "type": "object"
      },
      "name": "Close_conversation_history"
    },
    {
      "description": "Executes typst CLI commands through the embedded compiler. No external typst binary needed. Supports: compile, init, query, fonts, update, watch, unwatch, watchlist.\n\nSUBCOMMANDS:\n- 'typst compile <file.typ> [-o <output.pdf>]' — Compile a .typ file to PDF. Output defaults to same name with .pdf extension.\n- 'typst init @preview/<template>:<version> [directory]' — Download a template from Typst Universe and scaffold a project. Example: 'typst init @preview/brilliant-cv:2.0.3'.\n- 'typst watch <file.typ>' — Add a document to the auto-compile watchlist. Compiles immediately and records ALL dependencies (imports, images, bib files, toml, packages). From then on, editing ANY dependency auto-recompiles the PDF via a callback. Use this for documents the user is actively working on.\n- 'typst unwatch <file.typ>' — Remove a document from the watchlist.\n- 'typst watchlist' — List all watched documents and their dependency counts.\n- 'typst fonts [--variants]' — List available system fonts (creates a panel).\n- 'typst query <file.typ> <selector>' — Query document metadata (creates a panel).\n- 'typst update [@preview/pkg:version]' — Re-download cached packages.\n\nFILE ORGANIZATION — CRITICAL PRINCIPLES:\nContext Pilot is installed into the user's project. You MUST keep their workspace clean. The guiding principle: separate CONTENT (what the user cares about) from STYLING (reusable infrastructure). Content lives next to the document. Styling lives in .context-pilot/shared/.\n\nWhat goes in .context-pilot/shared/typst-templates/:\n- Template files (#let report = ..., #let invoice = ...) — reusable across documents\n- Shared styling (fonts, colors, layouts, page setup, headers/footers)\n- Shared assets used by templates (logos, icons, common images)\n- Shared data (company info TOML, common variables)\nThese are version-controlled and shared across all workers. They are infrastructure, not user content.\n\nWhat goes next to the document (in the user's project folder):\n- The .typ document itself — containing ONLY content (text, data, tables)\n- Content-specific assets (photos for THIS report, data files for THIS document)\n- The compiled .pdf output\n- Configuration (metadata.toml, bibliography .bib) specific to THIS document\nKeep the user's folders minimal — only what the user authored or needs to see.\n\nWhen using 'typst init' to scaffold from @preview/ templates:\n- The template's reusable styling/library files should go into .context-pilot/shared/typst-templates/\n- Only the user's content files (the actual document, data, images) should go in the project directory\n- This prevents template scaffolding from dumping dozens of infrastructure files into the user's workspace\n\nWORKFLOW — BEST PRACTICES:\n1. After creating or scaffolding a .typ document, ALWAYS run 'typst watch' on the main document so edits auto-recompile.\n2. When the user asks to create a PDF, first check if a suitable template exists in .context-pilot/shared/typst-templates/. If not, create one there, then create the document that imports it.\n3. Documents should #import templates: #import \"../../.context-pilot/shared/typst-templates/report.typ\": report\n4. 'typst watch' tracks the FULL dependency tree automatically — imports, images, bibliography files, toml config, even package files. No manual dependency management needed.\n5. Use 'typst compile' for one-off compilations. Use 'typst watch' for documents under active development.\n6. @preview/ packages are downloaded from Typst Universe and cached globally at ~/.cache/typst/packages/.",
      "input_schema": {
        "properties": {
          "command": {
            "description": "Full typst command string (e.g., 'typst compile doc.typ -o out.pdf', 'typst init @preview/graceful-genetics:0.2.0', 'typst fonts')",
            "type": "string"
          }
        },
        "required": [
          "command"
        ],
        "type": "object"
      },
      "name": "typst_execute"
    },
    {
      "description": "Search the web using Brave's independent 40-billion-page index. Returns snippets, URLs, and optional rich results (stocks, weather, calculator, crypto, sports). Always the FIRST tool to try for any web query (Tier 1). Supports search operators in query: \"exact phrase\", -exclude, site:domain, filetype:pdf.\n\nESCALATION: Start here. If snippets are insufficient, escalate to brave_llm_context (Tier 2) or firecrawl_scrape/firecrawl_search (Tier 3). Stop at the lowest tier that answers the query.\n\nPARAMETER GUIDANCE:\n- count: 3 for simple facts, 5 for multi-faceted, 5-10 for comparative/research\n- freshness: 'pd' (past day), 'pw' (past week), 'pm' (past month), 'py' (past year), or custom 'YYYY-MM-DDtoYYYY-MM-DD'\n- goggles_id: URL of a Brave Goggle for domain re-ranking. Load the 'brave-goggles' skill for curated recommendations.",
      "input_schema": {
        "properties": {
          "count": {
            "description": "Number of results (1-20, default 5)",
            "type": "integer"
          },
          "country": {
            "description": "2-letter ISO country code (default 'US')",
            "type": "string"
          },
          "freshness": {
            "description": "Recency filter: 'pd'|'pw'|'pm'|'py' or 'YYYY-MM-DDtoYYYY-MM-DD'",
            "type": "string"
          },
          "goggles_id": {
            "description": "Brave Goggle URL for domain re-ranking",
            "type": "string"
          },
          "query": {
            "description": "Search query. Supports operators: \"exact\", -exclude, site:domain, filetype:pdf",
            "type": "string"
          },
          "safe_search": {
            "description": "'off'|'moderate'|'strict' (default 'moderate')",
            "enum": [
              "off",
              "moderate",
              "strict"
            ],
            "type": "string"
          },
          "search_lang": {
            "description": "Result language ISO 639-1 (default 'en')",
            "type": "string"
          }
        },
        "required": [
          "query"
        ],
        "type": "object"
      },
      "name": "brave_search"
    },
    {
      "description": "Brave's LLM Context API returns pre-extracted, relevance-scored web content — text chunks, tables, code blocks, structured data — optimized for direct LLM consumption. No scraping needed. Use when brave_search snippets are insufficient (Tier 2).\n\nESCALATION: Use after brave_search when you need deeper content. If you need the full page, escalate to firecrawl_scrape (Tier 3).\n\nPARAMETER GUIDANCE:\n- maximum_number_of_tokens: 2048 for quick facts, 8192 default, 16384 for research, 32768 for deep analysis\n- context_threshold_mode: 'strict' for precise Q&A, 'balanced' default, 'lenient' for broad research, 'disabled' to dump everything",
      "input_schema": {
        "properties": {
          "context_threshold_mode": {
            "description": "Relevance threshold: 'strict'|'balanced'|'lenient'|'disabled' (default 'balanced')",
            "enum": [
              "strict",
              "balanced",
              "lenient",
              "disabled"
            ],
            "type": "string"
          },
          "count": {
            "description": "Max search results to consider (1-50, default 20)",
            "type": "integer"
          },
          "country": {
            "description": "2-letter ISO country code (default 'US')",
            "type": "string"
          },
          "freshness": {
            "description": "Recency filter: 'pd'|'pw'|'pm'|'py' or 'YYYY-MM-DDtoYYYY-MM-DD'",
            "type": "string"
          },
          "goggles": {
            "description": "Brave Goggle URL or inline definition",
            "type": "string"
          },
          "maximum_number_of_tokens": {
            "description": "Approx max tokens (1024-32768, default 8192)",
            "type": "integer"
          },
          "query": {
            "description": "Search query",
            "type": "string"
          }
        },
        "required": [
          "query"
        ],
        "type": "object"
      },
      "name": "brave_llm_context"
    },
    {
      "description": "Full-page content extraction from a single known URL. Renders JavaScript via headless Chromium. Returns clean markdown (~67% fewer tokens than raw HTML) plus page links. Use when you need the full content of a specific page (Tier 3a).\n\nESCALATION: Use after brave_search/brave_llm_context when snippets are insufficient and you have a specific URL to extract.\n\nFORMATS: 'markdown' (default, clean text), 'html', 'links' (all page URLs), 'summary', 'images'. Default: ['markdown', 'links'].",
      "input_schema": {
        "properties": {
          "formats": {
            "description": "Output formats: 'markdown'|'html'|'links'|'summary'|'images' (default ['markdown','links'])",
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          "location": {
            "description": "Optional location for geo-targeted scraping",
            "properties": {
              "country": {
                "description": "2-letter country code",
                "type": "string"
              },
              "languages": {
                "description": "Language codes",
                "items": {
                  "type": "string"
                },
                "type": "array"
              }
            },
            "required": [],
            "type": "object"
          },
          "url": {
            "description": "Target URL to scrape",
            "type": "string"
          }
        },
        "required": [
          "url"
        ],
        "type": "object"
      },
      "name": "firecrawl_scrape"
    },
    {
      "description": "Combined search + scrape in a single API call. Discovers URLs matching a query and returns full markdown content for the top results. Use when you need full pages but don't have specific URLs yet (Tier 3b).\n\nESCALATION: Use after brave_search when snippets are insufficient and you need deep content from multiple pages.\n\nCATEGORIES: 'github' (repos/code), 'research' (arxiv/nature/ieee), 'pdf'.\nTBS (time filter): 'qdr:h' (hour), 'qdr:d' (day), 'qdr:w' (week), 'qdr:m' (month), 'qdr:y' (year).",
      "input_schema": {
        "properties": {
          "categories": {
            "description": "Target categories: 'github'|'research'|'pdf'",
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          "limit": {
            "description": "Pages to scrape (1-10, default 3)",
            "type": "integer"
          },
          "location": {
            "description": "Location string, e.g. 'Germany', 'San Francisco,California'",
            "type": "string"
          },
          "query": {
            "description": "Search query",
            "type": "string"
          },
          "sources": {
            "description": "Source types: 'web'|'news'|'images' (default ['web'])",
            "items": {
              "type": "string"
            },
            "type": "array"
          },
          "tbs": {
            "description": "Time filter: 'qdr:h'|'qdr:d'|'qdr:w'|'qdr:m'|'qdr:y'",
            "type": "string"
          }
        },
        "required": [
          "query"
        ],
        "type": "object"
      },
      "name": "firecrawl_search"
    },
    {
      "description": "Discovers all URLs on a given domain. Primarily from sitemap, supplemented by SERP and cached crawl data. Use to explore a site's structure before targeted scraping (Tier 4).\n\nESCALATION: Use when you need to understand a site's structure to find the right pages to scrape. Typically followed by firecrawl_scrape.\n\nCOST: 1 credit per call regardless of URLs returned. Very cheap for exploration.",
      "input_schema": {
        "properties": {
          "include_subdomains": {
            "description": "Include subdomains (default false)",
            "type": "boolean"
          },
          "limit": {
            "description": "Max URLs returned (1-5000, default 50)",
            "type": "integer"
          },
          "location": {
            "description": "Optional location for geo-targeted mapping",
            "properties": {
              "country": {
                "description": "2-letter country code",
                "type": "string"
              },
              "languages": {
                "description": "Language codes",
                "items": {
                  "type": "string"
                },
                "type": "array"
              }
            },
            "required": [],
            "type": "object"
          },
          "search": {
            "description": "Optional keyword filter on discovered URLs",
            "type": "string"
          },
          "url": {
            "description": "Root domain or subdomain to map",
            "type": "string"
          }
        },
        "required": [
          "url"
        ],
        "type": "object"
      },
      "name": "firecrawl_map"
    }
  ],
  "stream": true
}